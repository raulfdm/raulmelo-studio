---
import "@raulmelo/code-highlight/styles/starry-theme.css";

import { type SupportedLanguages } from "@raulmelo/core/config";
import { highlight } from "@raulmelo/code-highlight";

import { getIntl } from "@/infrastructure/i18n/getServerSideLocales.server";

import CodeBlockSvelte from "./CodeBlock.svelte";

type Props = {
  node: {
    code: string;
    highlightedLines: string;
    language?: string;
    filename?: string;
    showLineNumbers?: boolean;
  };
};

const {
  code,
  highlightedLines,
  language,
  filename,
  showLineNumbers = true,
} = Astro.props.node;
const { lang } = Astro.params as { lang: SupportedLanguages };

const intl = getIntl(lang);
---

{
  code && (
    <CodeBlockSvelte
      client:load
      code={code}
      codeHtml={highlight(code, { language })}
      copyTitle={intl.formatMessage({ id: `blogPost.copyButton.title` })}
      filename={filename}
      highlightedLines={highlightedLines}
      language={language}
      showLineNumbers={showLineNumbers}
    />
  )
}
