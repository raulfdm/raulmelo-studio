---
import {
  getImageDimensionsFromSanityImageUrl,
  imgUrlFor,
  isEmpty,
  isNil,
} from '@raulmelo/core/utils';
import { ImageSlider } from '@raulmelo/ui';

type ImageNode = {
  alt: string;
  caption: string;
  image: {
    asset: {
      _ref: string;
    };
  };
};

type Props = {
  node: {
    images: ImageNode[];
  };
};

const { images } = Astro.props.node;

const isImageEmpty = isNil(images) || isEmpty(images);

const adaptedImages = images.map((img) => {
  const { alt, caption, image } = img;
  const src = imgUrlFor(image).url();

  const imgDimensions = getImageDimensionsFromSanityImageUrl(src);

  return {
    alt,
    caption,
    height: imgDimensions.height,
    width: imgDimensions.width,
    src: `${src}?fit=crop&auto=format`,
  };
});
---

{isImageEmpty ? null : <ImageSlider images={adaptedImages} client:visible />}
