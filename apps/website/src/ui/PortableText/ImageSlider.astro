---
import { imgUrlFor, isEmpty, isNil } from '@raulmelo/core/utils';
import { ImageSlider } from '@raulmelo/ui';

import { sanityClient } from '@/infrastructure/sanity/client';

type ImageNode = {
  alt: string;
  caption: string;
  image: {
    _type: 'image';
    asset: {
      _ref: string;
      _type: 'reference';
    };
  };
};

type Props = {
  node: {
    images: ImageNode[];
  };
};

const { images } = Astro.props.node;

const isImageEmpty = isNil(images) || isEmpty(images);

const adaptedImages = images.map((img) => {
  const { alt, caption, image } = img;

  const { height, width, url } = imgUrlFor(sanityClient, image);

  return {
    alt,
    caption,
    height,
    width,
    src: url,
  };
});
---

{isImageEmpty ? null : <ImageSlider images={adaptedImages} client:visible />}
